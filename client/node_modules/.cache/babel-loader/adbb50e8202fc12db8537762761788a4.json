{"ast":null,"code":"import _regeneratorRuntime from\"/home/kushal/tip-saza/client/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/kushal/tip-saza/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/kushal/tip-saza/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/kushal/tip-saza/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import NotFound from\"../components/global/NotFound\";import CardHoriz from\"../components/cards/CardHoriz\";import CreateForm from\"../components/cards/CreateForm\";import ReactQuill from\"../components/editor/ReactQuill\";import{validCreateBlog}from\"../utils/Valid\";import{ALERT}from\"../redux/types/alertType\";import{createBlog,updateBlog}from\"../redux/actions/blogActions\";import{getAPI}from\"../utils/FetchDatas\";import{shallowEqual}from'../utils/Valid';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreateBlog=function CreateBlog(_ref){var id=_ref.id;var initState={user:'',title:'',content:'',description:'',thumbnail:'',category:'',views:0,createdAt:new Date().toISOString()};var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth;var dispatch=useDispatch();var _useState=useState(initState),_useState2=_slicedToArray(_useState,2),blog=_useState2[0],setBlog=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),body=_useState4[0],setBody=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),text=_useState6[0],setText=_useState6[1];var _useState7=useState(initState),_useState8=_slicedToArray(_useState7,2),oldData=_useState8[0],setOldData=_useState8[1];var divRef=useRef(null);useEffect(function(){//before using useEffect id was console.logged many times but now it consoles one time only\nif(!id)return;getAPI(\"blog/\".concat(id))//get api is getting all the datas from the particular id\n.then(function(res){setBlog(res.data);setBody(res.data.content);setOldData(res.data);}).catch(function(err){return console.log(err);});var initData={user:'',title:'',content:'',description:'',thumbnail:'',category:'',views:0,createdAt:new Date().toISOString()};return function(){setBlog(initData);setBody('');setOldData(initData);};},[id]);useEffect(function(){var div=divRef.current;if(!div)return;var text=div===null||div===void 0?void 0:div.innerText;setText(text);},[body]);//means whenever the body changes re-render the component\nvar handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var check,newData,_auth$user,_auth$user2,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(auth.access_token){_context.next=2;break;}return _context.abrupt(\"return\");case 2:check=validCreateBlog(_objectSpread(_objectSpread({},blog),{},{content:text}));if(!(check.errLength!==0)){_context.next=5;break;}return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:check.errMsg}}));case 5:newData=_objectSpread(_objectSpread({},blog),{},{content:body});if(!id){_context.next=19;break;}if(!(blog.user._id===((_auth$user=auth.user)===null||_auth$user===void 0?void 0:_auth$user._id)||((_auth$user2=auth.user)===null||_auth$user2===void 0?void 0:_auth$user2.role)==='admin')){_context.next=11;break;}dispatch(updateBlog(newData,auth.access_token));_context.next=12;break;case 11:return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:\"Invalid Authentication\"}}));case 12:result=shallowEqual(oldData,newData);if(!result){_context.next=15;break;}return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:\"The Data has not been\"}}));case 15:setBlog(initState);setBody('');_context.next=22;break;case 19:dispatch(createBlog(newData,auth.access_token));setBlog(initState);setBody('');case 22:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(){return _ref2.apply(this,arguments);};}();if(!auth.access_token||!auth.user)return/*#__PURE__*/_jsx(NotFound,{});return/*#__PURE__*/_jsxs(\"div\",{className:\"container my-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-secondary\",children:\"Create Blog\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Create\"}),/*#__PURE__*/_jsx(CreateForm,{auth:auth,blog:blog,setBlog:setBlog})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 \",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Preview\"}),/*#__PURE__*/_jsx(CardHoriz,{blog:blog})]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(ReactQuill,{setBody:setBody,body:body})}),/*#__PURE__*/_jsx(\"div\",{ref:divRef,dangerouslySetInnerHTML:{__html:body},style:{display:'none'}}),/*#__PURE__*/_jsx(\"small\",{children:text.length}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-dark mt-3 d-block mx-auto\",onClick:handleSubmit,children:id?'Update':'Create'})]});};export default CreateBlog;","map":{"version":3,"sources":["/home/kushal/tip-saza/client/src/pages/create_blog.tsx"],"names":["React","useState","useRef","useEffect","useDispatch","useSelector","NotFound","CardHoriz","CreateForm","ReactQuill","validCreateBlog","ALERT","createBlog","updateBlog","getAPI","shallowEqual","CreateBlog","id","initState","user","title","content","description","thumbnail","category","views","createdAt","Date","toISOString","state","auth","dispatch","blog","setBlog","body","setBody","text","setText","oldData","setOldData","divRef","then","res","data","catch","err","console","log","initData","div","current","innerText","handleSubmit","access_token","check","errLength","type","payload","errors","errMsg","newData","_id","role","result","__html","display","length"],"mappings":"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","sourcesContent":["import React,{ useState,useRef, useEffect } from \"react\";\nimport { useDispatch,useSelector } from \"react-redux\";\nimport NotFound from \"../components/global/NotFound\";\nimport { RootStore,IBlog, IUser } from \"../utils/TypeScript\";\nimport CardHoriz from \"../components/cards/CardHoriz\";\nimport CreateForm from \"../components/cards/CreateForm\";\nimport ReactQuill from \"../components/editor/ReactQuill\";\nimport { validCreateBlog } from \"../utils/Valid\";\nimport { ALERT } from \"../redux/types/alertType\";\nimport { createBlog,updateBlog } from \"../redux/actions/blogActions\";\nimport { getAPI } from \"../utils/FetchDatas\";\nimport { shallowEqual } from '../utils/Valid'\n\ninterface IProps{\n    id?: string\n}\n\nconst CreateBlog: React.FC<IProps> = ({id}) => {\n\n    const initState = {\n        user: '',\n        title: '',\n        content: '',\n        description: '',\n        thumbnail: '',\n        category: '',\n        views: 0,\n        createdAt: new Date().toISOString()\n    }\n\n    const { auth } = useSelector((state: RootStore) => state)\n    const dispatch = useDispatch()\n\n    const [ blog,setBlog ] = useState<IBlog>(initState)\n    const [ body,setBody ] = useState('')\n    const [ text,setText ] = useState('')\n    const [ oldData,setOldData ] = useState<IBlog>(initState)\n    const divRef = useRef<HTMLDivElement>(null)\n\n    useEffect(() => {  //before using useEffect id was console.logged many times but now it consoles one time only\n        if(!id) return;\n\n        getAPI(`blog/${id}`)  //get api is getting all the datas from the particular id\n        .then(res => {\n            setBlog(res.data)\n            setBody(res.data.content)\n            setOldData(res.data)\n        })\n        .catch(err => console.log(err))\n\n        const initData = {\n            user: '',\n            title: '',\n            content: '',\n            description: '',\n            thumbnail: '',\n            category: '',\n            views: 0,\n            createdAt: new Date().toISOString()\n        }\n\n        return () => {\n            setBlog(initData)\n            setBody('')\n            setOldData(initData)\n        }\n        \n    },[id])\n\n    useEffect(() => {\n        const div = divRef.current;\n        if(!div) return\n\n        const text = (div?.innerText as string)\n        setText(text)\n    },[body])   //means whenever the body changes re-render the component\n\n    const handleSubmit = async () => {\n        if(!auth.access_token) return;\n\n        const check = validCreateBlog({ ...blog, content:text})\n        if(check.errLength !== 0) return dispatch({type: ALERT, payload: {errors: check.errMsg}})\n        \n        let newData = {...blog, content: body}\n\n        if(id) {\n            if((blog.user as IUser)._id === auth.user?._id || auth.user?.role === 'admin') {\n                dispatch(updateBlog(newData, auth.access_token))\n            } else {\n                return dispatch({\n                    type: ALERT,\n                    payload: { errors: \"Invalid Authentication\"}\n                })\n            }\n\n\n            const result = shallowEqual(oldData, newData)\n            if(result) return dispatch({\n                type: ALERT,\n                payload: { errors: \"The Data has not been\"}\n            })\n\n            setBlog(initState)\n            setBody('')\n        }else{\n            dispatch(createBlog(newData, auth.access_token))\n            setBlog(initState)\n            setBody('')\n        }\n    }\n\n    if(!auth.access_token || !auth.user) return <NotFound />\n    return(\n        <div className=\"container my-4\">\n            <h2 className=\"text-secondary\">Create Blog</h2>\n            <div className=\"row mt-4\">\n                <div className=\"col-md-6\">\n                    <h5>Create</h5>\n                    <CreateForm auth={auth} blog={blog} setBlog={setBlog} />\n                </div>\n\n                <div className=\"col-md-6 \">\n                    <h5>Preview</h5>\n                    <CardHoriz blog={blog}/>\n                </div>\n            </div>\n            <div>\n                <ReactQuill setBody={setBody} body={body} />\n            </div>\n        \n            <div ref={divRef} dangerouslySetInnerHTML={{\n                __html: body\n            }} style={{display:'none'}} />\n            <small>{text.length}</small>\n\n            <button className=\"btn btn-dark mt-3 d-block mx-auto\" onClick={handleSubmit}>\n                { id ? 'Update' : 'Create' }\n            </button>\n        </div>\n    )\n}\n\nexport default CreateBlog;"]},"metadata":{},"sourceType":"module"}